{% load static %}

<div class="flavor">
    <p class="errata">An error was corrected at Sunday 6:25 AM TIMEMIT. In question 3122, a grammatically incorrect “one” was removed. The question formerly read “Which turnip would you like to examine one more closely?”. It now reads “Which turnip would you like to examine more closely?”.</p>
</div>

<section>
    <p>Welcome to the Experimental Community Garden. Though “community” is stretching it a bit. Our members don’t get
        along, so I wouldn't describe us as commutative. On the other hand, innovation is a strength here. We’re
        not sure anyone else operates the same way.</p>
    <p>Over here you can see the most recent set of experiments by the gardeners, though I seem to have lost the
        results. No matter, I'm sure we can get to them somehow.</p>
    <p>The first three are the example experiments for new gardeners. They don't actually go anywhere, but they can be
        very elucidating.</p>

    <div>
        <div class="equation-container">
            <details class="long-alt">
                <summary>
                    <img src="media/equation1.png" alt="an equation with names instead of numbers">
                </summary>
                <p>A mathematical equation, with phrases in grey boxes instead of numbers. Thick black borders around
                    sections of boxes are here represented by brackets. Groups of boxes without gaps inbetween them are
                    represented by parentheses. [Quercus palustris + Convallaria majalis] -
                    Coriandrum sativum = {}</p>
            </details>
        </div>
        <div class="equation-container">
            <details class="long-alt">
                <summary>
                    <img src="media/equation2.png" alt="an equation with names instead of numbers">
                </summary>
                <p>A mathematical equation, with phrases in grey boxes instead of numbers. Thick black borders around
                    sections of boxes are here represented by brackets. Groups of boxes without gaps inbetween them are
                    represented by parentheses. (Haworthia cooperi &times; Hydrangea paniculata) -
                    [Abies balsamea + Capsicum chinese 'Habanero' + Victoria amazonica]^&Dagger; = {}</p>
            </details>
        </div>
        <div class="equation-container">
            <details class="long-alt">
                <summary>
                    <img src="media/equation3.png" alt="an equation with names instead of numbers">
                </summary>
                <p>A mathematical equation, with phrases in grey boxes instead of numbers. Thick black borders around
                    sections of boxes are here represented by brackets. Groups of boxes without gaps inbetween them are
                    represented by parentheses. [[(Corylus avellana &times; Carnegiea gigantea) -
                    Cucurbita maxima 'Blue Hubbard - 'Solanum tuberosum 'Yukon Gold'] &div; Fragaria vesca] - Zea mays
                    var everta = {}</p>
            </details>
        </div>
        <div class="equation-container">
            <details class="long-alt">
                <summary>
                    <img src="media/equation4.png" alt="an equation with names instead of numbers">
                </summary>
                <p>A mathematical equation, with phrases in green boxes instead of numbers. There is a parenthesized
                    number 6 to the right of the equation. Thick black borders around
                    sections of boxes are here represented by brackets. Groups of boxes without gaps inbetween them are
                    represented by parentheses. (Cercidiphyllum japonicum - Salvia officinalis) +
                    (Ilex paraguariensis &times; Occimum x africanum) + Synsepalum dulcificum = ?</p>
            </details>
        </div>
        <div class="equation-container">
            <details class="long-alt">
                <summary>
                    <img src="media/equation5.png" alt="an equation with names instead of numbers">
                </summary>
                <p>A mathematical equation, with phrases in green boxes instead of numbers. There is a parenthesized
                    number 12 to the right of the equation. Thick black borders around
                    sections of boxes are here represented by brackets. Groups of boxes without gaps inbetween them are
                    represented by parentheses. (Cornus nuttallii + Thymus herba-barona +
                    Myriophyllum aquaticum + Lithops optica 'Rubra') + ([Robinia pseudoacacia &times; Solanum lycopersicum
                    'San Marzano'] - Prunus avium 'Rainier') = ?</p>
            </details>
        </div>
        <div class="equation-container">
            <details class="long-alt">
                <summary>
                    <img src="media/equation6.png" alt="an equation with names instead of numbers">
                </summary>
                <p>A mathematical equation, with phrases in green boxes instead of numbers. There is a parenthesized
                    number 14 to the right of the equation. Thick black borders around
                    sections of boxes are here represented by brackets. Groups of boxes without gaps inbetween them are
                    represented by parentheses. Persea americana 'Hass' &times; (Cymbopogon
                    citratus + Raphanus sativus 'Nile')^&Dagger; = ?</p>
            </details>
        </div>
        <div class="equation-container">
            <details class="long-alt">
                <summary>
                    <img src="media/equation7.png" alt="an equation with names instead of numbers">
                </summary>
                <p>A mathematical equation, with phrases in green boxes instead of numbers. There is a parenthesized
                    number 23 to the right of the equation. Thick black borders around
                    sections of boxes are here represented by brackets. Groups of boxes without gaps inbetween them are
                    represented by parentheses. (Syringa vulgaris + Curio radicans^&Dagger; +
                    Zizania palustris) = ?</p>
            </details>
        </div>
        <div class="equation-container">
            <details class="long-alt">
                <summary>
                    <img src="media/equation8.png" alt="an equation with names instead of numbers">
                </summary>
                <p>A mathematical equation, with phrases in green boxes instead of numbers. There is a parenthesized
                    number 3 to the right of the equation. Thick black borders around
                    sections of boxes are here represented by brackets. Groups of boxes without gaps inbetween them are
                    represented by parentheses. [(Malus domestica 'Crimson King' &times;
                    Juniperus scopulorum)^&Dagger; &div; Opuntia polyacantha] + (Ribes uva-crispa &times; Gaultheria
                    procumbens)^&Dagger; = ?</p>
            </details>
        </div>
        <div class="equation-container">
            <details class="long-alt">
                <summary>
                    <img src="media/equation9.png" alt="an equation with names instead of numbers">
                </summary>
                <p>A mathematical equation, with phrases in green boxes instead of numbers. There is a parenthesized
                    number 7 to the right of the equation. Thick black borders around
                    sections of boxes are here represented by brackets. Groups of boxes without gaps inbetween them are
                    represented by parentheses. [([Triticum aestivum &times; Feijoa sellowiana] +
                    [Zamia furfuracea + Acer saccharum + Prunus amygdalus + Cucumis melo var cantalupo]) &div; Carya
                    illinoinensis]^&Dagger; &times; (Allium ampeloprasum var ampeloprasum - Oryza sativa) = ?</p>
            </details>
        </div>
        <div class="equation-container">
            <details class="long-alt">
                <summary>
                    <img src="media/equation10.png" alt="an equation with names instead of numbers">
                </summary>
                <p>A mathematical equation, with phrases in green boxes instead of numbers. There is a parenthesized
                    number 7 to the right of the equation. Thick black borders around
                    sections of blocks are here represented by brackets. Groups of boxes without gaps inbetween them are
                    represented by parentheses. (Camellia jaopnica &times; Acer rubrum) + (Punica
                    granatum &times; Raphanus sativus 'French Breakfast')^&Dagger; - (Juglans regia &times; Sarracenia
                    leucophylla)^&Dagger; = ?</p>
            </details>
        </div>
    </div>

    <p>Stroll with me up the garden paths. The gardeners have their own way of classifying the plants here, and I must
        admit I find it quite idiosyncratic. No worse than some taxonomies, to be sure, but the categorization is very
        much a matter of taste. Sometimes literally.</p>
    <p>The plants are idiosyncratic, too. You’d think trees and stems would branch, but around here they don’t. Nothing
        seems to branch at all. </p>

    <hr/>
    <h2 class="question-label"></h2>
    <div class="branch">
        <p class="branch-prompt"></p>
        <div class="buttons-container">
            <button class="main-button left-option"></button>
            <button class="main-button center-option"></button>
            <button class="main-button right-option"></button>
        </div>
    </div>
    <div class="leaf">
        <p>
            <span class="before"></span>
            <span class="species"></span>
            <span class="after"></span>
        </p>
        <img class="leaf-image">
    </div>
    <hr class="back-buttons-separator">
    <div class="back-buttons"></div>

</section>

<script type="module">
    import Cookies from "{% static 'lib/js-cookie.module.min.js' %}";

    const staticDirectory = window.puzzleStaticDirectory;


    // Export globally so the auto onload handler can find this.
    window.puzzleOnLoad = () => fetchQuestion('');

    const csrfToken = Cookies.get('csrftoken');

    const plantAltText = {
        '1': 'Two circles. A line going up and left connects the bottom circle, black, to the top circle, white',
        '2': 'Two circles. A line going up connects the bottom circle, black, to the top circle, white',
        '3': 'Two circles. A line going up and right connects the bottom circle, black, to the top circle, white',
        '11': 'Three circles. A line going up and left connects the bottom circle, black, to the second circle, white, and a line going up and left connects the second circle to the third circle, white',
        '12': 'Three circles. A line going up and left connects the bottom circle, black, to the second circle, white, and a line going up connects the second circle to the third circle, white',
        '13': 'Three circles. A line going up and left connects the bottom circle, black, to the second circle, white, and a line going up and right connects the second circle to the third circle, white',
        '21': 'Three circles. A line going up connects the bottom circle, black, to the second circle, white, and a line going up and left connects the second circle to the third circle, white',
        '22': 'Three circles. A line going up connects the bottom circle, black, to the second circle, white, and a line going up connects the second circle to the third circle, white',
        '23': 'Three circles. A line going up connects the bottom circle, black, to the second circle, white, and a line going up and right connects the second circle to the third circle, white',
        '31': 'Three circles. A line going up and right connects the bottom circle, black, to the second circle, white, and a line going up and left connects the second circle to the third circle, white',
        '32': 'Three circles. A line going up and right connects the bottom circle, black, to the second circle, white, and a line going up connects the second circle to the third circle, white',
        '33': 'Three circles. A line going up and right connects the bottom circle, black, to the second circle, white, and a line going up and right connects the second circle to the third circle, white',
    };

    function fetchQuestion(questionCode) {
        fetch('{{ puzzle_info.full_path }}state', {
            method: 'POST',
            mode: 'same-origin',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken,
            },
            body: JSON.stringify({'question-code': questionCode}),
        })
            .then(response => response.json())
            .then((data) => {
                $('.question-label').empty()
                if (data.type === 'branch') {
                    $('.branch').removeClass('hidden');
                    $('.leaf').addClass('hidden');
                    if (data.question_code) {
                        $('.question-label').html('Question ' + data.question_code)
                    }
                    $('.branch-prompt').html(data.prompt).show();
                    $('.left-option').html(data.left_option).show();
                    $('.left-option').unbind('click');
                    $('.left-option').on('click', () => fetchQuestion(data.question_code + '1'))
                    $('.center-option').html(data.center_option).show();
                    $('.center-option').unbind('click');
                    $('.center-option').on('click', () => fetchQuestion(data.question_code + '2'))
                    $('.right-option').html(data.right_option).show();
                    $('.right-option').unbind('click');
                    $('.right-option').on('click', () => fetchQuestion(data.question_code + '3'))
                } else {
                    $('.question-label').html(data.question_code)
                    $('.branch').addClass('hidden');
                    $('.leaf').removeClass('hidden');
                    $('.before').html(data.text_before).show();
                    $('.species').html(data.species_name + '.').show();
                    $('.after').html(data.text_after).show();
                    $('.leaf-image').attr('src', staticDirectory + "media/plant" + data.image_code + ".png")
                    $('.leaf-image').attr('alt', plantAltText[data.image_code])
                }
                $('.back-buttons').empty();
                for (let codeLength = 0; codeLength < data.question_code.length; codeLength++) {
                    const content = codeLength === 0 ? 'start' : ('Question ' + data.question_code.substring(0, codeLength));
                    $('.back-buttons').append('<div><button id="back-button-' + codeLength + '">Go back to ' + content + '</button></div>');
                    $('#back-button-' + codeLength).on('click', () => fetchQuestion(data.question_code.substring(0, codeLength)));
                }
            })
    }
</script>
